<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="webpack çƒ­æ›´æ–°åŸç†"><meta name="keywords" content="webpack"><meta name="author" content="Yin-Hongwei"><meta name="copyright" content="Yin-Hongwei"><title>webpack çƒ­æ›´æ–°åŸç† | Yin-Hongwei</title><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script></head><body><header id="page-header"><nav id="navbar"><span class="nav-left"><div class="tou-img"><img src="/img/avatar.jpg"></div><a id="site-name" href="/">Yin-Hongwei</a></span><i class="fa fa-bars toggle-menu nav-right" aria-hidden="true"></i><span class="title">webpack çƒ­æ›´æ–°åŸç†</span><span class="nav-right menus"><a class="site-page" href="/about">å…³äºæˆ‘</a></span></nav></header><article id="content-outer"><section id="content-inner"><article class="article-entry" id="post"><h1>webpack çƒ­æ›´æ–°åŸç†</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h2><p>éšç€å‰ç«¯æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼Œæ„å»ºå·¥å…·ä¸æˆ‘ä»¬çš„å¼€å‘å·²å¯†ä¸å¯åˆ†ï¼Œä½†æ˜¯æ— è®ºé€‰æ‹©å“ªæ¬¾æ„å»ºå·¥å…·ï¼Œæˆ‘ä»¬éƒ½æˆ–å¤šæˆ–å°‘çš„ä½¿ç”¨è¿‡ä»–ä»¬çƒ­æ›´æ–°çš„èƒ½åŠ›ï¼Œä»Šå¤©å°±ä»¥ webpack ä¸ºä¾‹ï¼Œæ¥çœ‹ webpack çƒ­æ›´æ–°çš„åŸç†ã€‚</p>
<p>è¦å®ç°çƒ­æ›´æ–°çš„èƒ½åŠ›ï¼Œé¦–å…ˆ webpack è¦å…·å¤‡æ–‡ä»¶ç›‘å¬çš„èƒ½åŠ›ï¼Œå…¶æ¬¡ä¹Ÿè¦å…·å¤‡æ¨¡å—æ„å»ºçš„èƒ½åŠ›ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä»æ— åˆ°æœ‰çš„çœ‹ webpack çƒ­æ›´æ–°çš„åŸç†ã€‚</p>
<a id="more"></a>
<h2 id="ä¸€ã€webpack-ç¼–è¯‘åŸç†"><a href="#ä¸€ã€webpack-ç¼–è¯‘åŸç†" class="headerlink" title="ä¸€ã€webpack ç¼–è¯‘åŸç†"></a><strong>ä¸€ã€webpack ç¼–è¯‘åŸç†</strong></h2><p>å…ˆåˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œçœ‹åœ¨ä¸å¼•å…¥æ„å»ºå·¥å…·çš„æƒ…å†µä¸‹ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ã€‚</p>
<h3 id="1ã€æ–°å»ºé¡¹ç›®"><a href="#1ã€æ–°å»ºé¡¹ç›®" class="headerlink" title="1ã€æ–°å»ºé¡¹ç›®"></a><strong>1ã€æ–°å»ºé¡¹ç›®</strong></h3><h4 id="1-1ã€æ–°å»ºé¡¹ç›®"><a href="#1-1ã€æ–°å»ºé¡¹ç›®" class="headerlink" title="1.1ã€æ–°å»ºé¡¹ç›®"></a>1.1ã€<strong>æ–°å»ºé¡¹ç›®</strong></h4><p>æ–°å»ºé¡¹ç›®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir webpack-hmr-demo</span><br><span class="line"><span class="built_in">cd</span> webpack-hmr-demo</span><br></pre></td></tr></table></figure>
<p> é¡¹ç›®ç»“æ„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ index.html</span><br><span class="line">â””â”€â”€ src</span><br><span class="line">    â”œâ”€â”€ App.vue</span><br><span class="line">    â”œâ”€â”€ assets</span><br><span class="line">    â”‚   â”œâ”€â”€ css</span><br><span class="line">    â”‚   â”‚   â””â”€â”€ index.css</span><br><span class="line">    â”‚   â””â”€â”€ js</span><br><span class="line">    â”‚       â””â”€â”€ index.js</span><br><span class="line">    â””â”€â”€ main.js</span><br></pre></td></tr></table></figure>
<p>main.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">"vue"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">"./App.vue"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./assets/css/index.css"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = createApp(App);</span><br><span class="line">app.mount(<span class="string">"#app"</span>);</span><br></pre></td></tr></table></figure>
<p>App.vue</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;&#123;&#123; msg &#125;&#125;&lt;/div&gt;</span><br><span class="line">&lt;input type=&quot;text&quot; /&gt;</span><br><span class="line">&lt;button @click=&quot;handleClick&quot;&gt;ç‚¹å‡»&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  import &#123; defineComponent, ref &#125; from &quot;vue&quot;;</span><br><span class="line">  </span><br><span class="line">  import &#123; modification &#125; from &quot;./assets/js/index&quot;;</span><br><span class="line">  </span><br><span class="line">  export default defineComponent(&#123;</span><br><span class="line">    name: &quot;App&quot;,</span><br><span class="line">    setup() &#123;</span><br><span class="line">      const msg = ref(&quot;hello world&quot;);</span><br><span class="line">      </span><br><span class="line">      function handleClick() &#123;</span><br><span class="line">        msg.value = modification(msg.value);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      return &#123;</span><br><span class="line">        msg,</span><br><span class="line">        handleClick,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>assets/js/index.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">modification</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;str&#125;</span>!!!`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>assets/css/index.css</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#app</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">25px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹‹ååœ¨ index.html ä¸­å¼•å…¥ main.js æ–‡ä»¶ï¼Œç†æƒ³çŠ¶æ€ä¸‹ï¼Œé€šè¿‡æµè§ˆå™¨åº”è¯¥æ˜¯èƒ½ç›´æ¥è®¿é—®æˆ‘ä»¬å†™çš„é¡µé¢çš„ï¼Œä½†æ˜¯é€šè¿‡æµè§ˆå™¨æ‰“å¼€åï¼Œä¼šå‘ç°æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h6htwhrq36j217206gt9s.jpg" alt></p>
<h4 id="1-2ã€é—®é¢˜åˆ†æ"><a href="#1-2ã€é—®é¢˜åˆ†æ" class="headerlink" title="1.2ã€é—®é¢˜åˆ†æ"></a>1.2ã€é—®é¢˜åˆ†æ</h4><p>JavaScript æœ‰ä¸¤ç§æºæ–‡ä»¶ï¼Œä¸€ç§æ˜¯è„šæœ¬ï¼Œå¦ä¸€ç§æ˜¯æ¨¡å—ã€‚äºŒè€…çš„åŒºåˆ«æ˜¯è„šæœ¬åªæœ‰è¯­å¥ï¼Œæ¨¡å—é™¤äº†è¯­å¥ï¼Œè¿˜æœ‰ import å£°æ˜æˆ– export å£°æ˜ã€‚</p>
<p>main.js æ–‡ä»¶å±äºæ¨¡å—ï¼Œè€Œ script æ ‡ç­¾çš„ type å±æ€§é»˜è®¤æ˜¯ text/javascript ï¼Œæ‰€ä»¥æµè§ˆå™¨é»˜è®¤ä¼šå°†å®ƒä½œä¸ºè„šæœ¬è¿›è¡Œè§£æï¼Œæ‰€ä»¥æ­¤å¤„éœ€è¦æŠŠ type ä¿®æ”¹ä¸º module ï¼Œå°† main.js ä½œä¸ºæ¨¡å—å¼•å…¥ã€‚</p>
<p>ä½†æ˜¯ä¿®æ”¹åä¾ç„¶æŠ¥é”™ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h6hu1dei63j217e09atbs.jpg" alt></p>
<p>è¿™æ˜¯å› ä¸ºè„šæœ¬è¢«è·¨åŸŸç­–ç•¥ç»™æ‹¦æˆªäº†ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„åè®®æ˜¯ fileã€è€Œè·¨åŸŸè¯·æ±‚åªæ”¯æŒè¿™äº›åè®®ï¼šhttpã€dataã€chromeã€chrome-extensionã€chrome-untrustedã€httpsï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæœåŠ¡æ¥ä½œä¸ºèµ„æºçš„æä¾›æ–¹ï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯é€šè¿‡ VSCode å®‰è£…ä¸€ä¸ªæ’ä»¶ Live Serverã€‚</p>
<p>è·¨åŸŸè§£å†³äº†ä½†æ˜¯é¡¹ç›®ä¾ç„¶è·‘ä¸èµ·æ¥ï¼Œå› ä¸ºæ²¡æœ‰å¼•å…¥ vue çš„æ¨¡å—ï¼Œå³ä½¿åœ¨ node_modules ä¸‹å®‰è£…äº†æµè§ˆå™¨ä¹Ÿæ‰¾ä¸åˆ°ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å¯¹åº”çš„æŸ¥æ‰¾è§„åˆ™ï¼Œå¹¶ä¸”åœ¨é¡¹ç›®ä¸­æˆ‘ä»¬ä¹Ÿä¸èƒ½éœ€è¦ä»€ä¹ˆå°±é€šè¿‡ cdn çš„æ–¹å¼å¼•å…¥æˆ–ç›´æ¥æŠŠå¯¹åº”æ¨¡å—ä¸‹è½½åˆ°æœ¬åœ°ï¼Œè¿™ä¸ªåœ¨åæœŸæ¨¡å—çš„ç»´æŠ¤ç®¡ç†æ–¹é¢éƒ½ä¼šå¸¦æ¥é—®é¢˜ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h6hu20xtksj216y0643zw.jpg" alt></p>
<p>æ‰€ä»¥è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨æ„å»ºå·¥å…·æ¥å¸®æˆ‘ä»¬å¯¹æ–‡ä»¶åšå¤„ç†è®©æµè§ˆå™¨èƒ½è®¤è¯†ã€‚</p>
<h3 id="2ã€ä½¿ç”¨"><a href="#2ã€ä½¿ç”¨" class="headerlink" title="2ã€ä½¿ç”¨"></a>2ã€ä½¿ç”¨</h3><h4 id="2-1ã€å®‰è£…ä¾èµ–"><a href="#2-1ã€å®‰è£…ä¾èµ–" class="headerlink" title="2.1ã€å®‰è£…ä¾èµ–"></a><strong>2.1ã€å®‰è£…ä¾èµ–</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yarn init -y</span><br><span class="line"></span><br><span class="line">yarn add webpack webpack-cli --save-dev</span><br><span class="line">yarn add @babel/core @babel/preset-env babel-loader --save-dev</span><br><span class="line">yarn add vue vue-loader vue-template-compiler --save-dev</span><br><span class="line">yarn add html-webpack-plugin --save-dev</span><br><span class="line">yarn add css-loader style-loader --save-dev</span><br></pre></td></tr></table></figure>
<h4 id="2-2ã€é¡¹ç›®é…ç½®"><a href="#2-2ã€é¡¹ç›®é…ç½®" class="headerlink" title="2.2ã€é¡¹ç›®é…ç½®"></a><strong>2.2ã€é¡¹ç›®é…ç½®</strong></h4><p>é…ç½® build/webpack.dev.js æ–‡ä»¶</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">"clean-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; VueLoaderPlugin &#125; = <span class="built_in">require</span>(<span class="string">"vue-loader"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">"development"</span>,</span><br><span class="line">  entry: path.join(__dirname, <span class="string">"../src/main.js"</span>),</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">"bundle.js"</span>,</span><br><span class="line">    path: path.join(__dirname, <span class="string">"../dist"</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        exclude: <span class="string">"/node_modules/"</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">"babel-loader"</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            presets: [<span class="string">"@babel/preset-env"</span>],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.vue$/</span>,</span><br><span class="line">        loader: <span class="string">"vue-loader"</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [<span class="string">"style-loader"</span>, <span class="string">"css-loader"</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">    <span class="keyword">new</span> VueLoaderPlugin(),</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">"./index.html"</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>é…ç½®ç¼–è¯‘å‘½ä»¤</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"build"</span>: <span class="string">"webpack --config build/webpack.dev.js"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3ã€è¿è¡Œ"><a href="#2-3ã€è¿è¡Œ" class="headerlink" title="2.3ã€è¿è¡Œ"></a><strong>2.3ã€è¿è¡Œ</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn build</span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h6hu2iwvi7j215k0ds751.jpg" alt></p>
<h3 id="3ã€ç¼–è¯‘ç»“æœ"><a href="#3ã€ç¼–è¯‘ç»“æœ" class="headerlink" title="3ã€ç¼–è¯‘ç»“æœ"></a><strong>3ã€ç¼–è¯‘ç»“æœ</strong></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"><span class="meta">  "use strict"</span>;</span><br><span class="line">  <span class="keyword">var</span> __webpack_modules__ = ([])</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__webpack_require__</span>(<span class="params">moduleId</span>) </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> __webpack_exports__ = &#123;&#125;;</span><br><span class="line">  </span><br><span class="line">  (<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">__webpack_require__.r(__webpack_exports__);</span><br><span class="line"><span class="comment">/* harmony import */</span> <span class="keyword">var</span> vue__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(<span class="comment">/*! vue */</span> <span class="string">"./node_modules/vue/dist/vue.runtime.esm-bundler.js"</span>);</span><br><span class="line"><span class="comment">/* harmony import */</span> <span class="keyword">var</span> _App_vue__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(<span class="comment">/*! ./App.vue */</span> <span class="string">"./src/App.vue"</span>);</span><br><span class="line"><span class="comment">/* harmony import */</span> <span class="keyword">var</span> _assets_css_index_css__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(<span class="comment">/*! ./assets/css/index.css */</span> <span class="string">"./src/assets/css/index.css"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = (<span class="number">0</span>,vue__WEBPACK_IMPORTED_MODULE_0__.createApp)(_App_vue__WEBPACK_IMPORTED_MODULE_1__[<span class="string">"default"</span>]);</span><br><span class="line">  &#125;)();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<ul>
<li>æ‰“åŒ…åçš„ç»“æœæ˜¯ä¸€ä¸ªIIFEï¼ˆåŒ¿åé—­åŒ…ï¼‰</li>
<li><strong>webpack_modules</strong> ç”¨æ¥è®°å½•å½“å‰ä¾èµ–çš„æ‰€æœ‰æ¨¡å—</li>
<li><strong>webpack_require</strong> ç”¨æ¥åŠ è½½æ¨¡å—</li>
<li>æœ€åä¸€æ®µ IIFE å¯¹åº”çš„å°±æ˜¯æˆ‘ä»¬å¼€å¤´å†™å¥½çš„ main.js æ–‡ä»¶</li>
</ul>
<h3 id="4ã€å®ç°åŸç†"><a href="#4ã€å®ç°åŸç†" class="headerlink" title="4ã€å®ç°åŸç†"></a><strong>4ã€å®ç°åŸç†</strong></h3><h4 id="4-1ã€æ‰§è¡Œè¿‡ç¨‹"><a href="#4-1ã€æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="4.1ã€æ‰§è¡Œè¿‡ç¨‹"></a>4.1ã€æ‰§è¡Œè¿‡ç¨‹</h4><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h6hu304qxtj21du0ocdhb.jpg" alt></p>
<h4 id="4-2ã€åŸç†åˆ†æ"><a href="#4-2ã€åŸç†åˆ†æ" class="headerlink" title="4.2ã€åŸç†åˆ†æ"></a>4.2ã€åŸç†åˆ†æ</h4><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h6hu3kzveej214m0kijsv.jpg" alt></p>
<h2 id="äºŒã€æ–‡ä»¶ç›‘å¬"><a href="#äºŒã€æ–‡ä»¶ç›‘å¬" class="headerlink" title="äºŒã€æ–‡ä»¶ç›‘å¬"></a><strong>äºŒã€æ–‡ä»¶ç›‘å¬</strong></h2><p>ç»è¿‡æ„å»ºå·¥å…·çš„å¤„ç†ï¼Œæµè§ˆå™¨å·²ç»èƒ½è¿è¡Œæˆ‘ä»¬å†™å¥½çš„ä»£ç äº†ï¼Œä½†æ˜¯æ¯æ¬¡ä¿®æ”¹å®Œçœ‹æ¸²æŸ“æ•ˆæœéƒ½éœ€è¦æ‰‹åŠ¨å»ç¼–è¯‘ï¼Œè¿™å°±å¾ˆå½±å“å¼€å‘æ•ˆç‡ã€‚</p>
<p>webpack æä¾›äº†ç›‘å¬æ–‡ä»¶å˜åŒ–ï¼Œå˜åŒ–åå°±è‡ªåŠ¨ç¼–è¯‘çš„ç­–ç•¥ã€‚</p>
<h3 id="1ã€ä½¿ç”¨"><a href="#1ã€ä½¿ç”¨" class="headerlink" title="1ã€ä½¿ç”¨"></a><strong>1ã€ä½¿ç”¨</strong></h3><h4 id="1-1ã€å®‰è£…ä¾èµ–"><a href="#1-1ã€å®‰è£…ä¾èµ–" class="headerlink" title="1.1ã€å®‰è£…ä¾èµ–"></a><strong>1.1ã€å®‰è£…ä¾èµ–</strong></h4><p>åŒä¸Š</p>
<h4 id="1-2ã€é¡¹ç›®é…ç½®"><a href="#1-2ã€é¡¹ç›®é…ç½®" class="headerlink" title="1.2ã€é¡¹ç›®é…ç½®"></a><strong>1.2ã€é¡¹ç›®é…ç½®</strong></h4><p>åœ¨é…ç½® webpack.config.js ä¸­è®¾ç½® watch: true æˆ–è€…å¯åŠ¨ webpack å‘½ä»¤æ—¶å¸¦ä¸Š â€“watch å‚æ•°ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"build"</span>: <span class="string">"webpack --config build/webpack.dev.js"</span>,</span><br><span class="line">    <span class="attr">"watch"</span>: <span class="string">"webpack --config build/webpack.dev.js --watch"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-3ã€è¿è¡Œ"><a href="#1-3ã€è¿è¡Œ" class="headerlink" title="1.3ã€è¿è¡Œ"></a><strong>1.3ã€è¿è¡Œ</strong></h4><p>è¿è¡Œåæ¯æ¬¡ä¿®æ”¹å®Œä¿å­˜å webpack éƒ½ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å»ç¼–è¯‘ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn watch</span><br></pre></td></tr></table></figure>
<h3 id="2ã€ç¼–è¯‘ç»“æœ"><a href="#2ã€ç¼–è¯‘ç»“æœ" class="headerlink" title="2ã€ç¼–è¯‘ç»“æœ"></a><strong>2ã€ç¼–è¯‘ç»“æœ</strong></h3><p>åŒä¸Š</p>
<h3 id="3ã€å®ç°åŸç†"><a href="#3ã€å®ç°åŸç†" class="headerlink" title="3ã€å®ç°åŸç†"></a><strong>3ã€å®ç°åŸç†</strong></h3><h4 id="3-1ã€æ‰§è¡Œè¿‡ç¨‹"><a href="#3-1ã€æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="3.1ã€æ‰§è¡Œè¿‡ç¨‹"></a>3.1ã€æ‰§è¡Œè¿‡ç¨‹</h4><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h6hu48vwxlj21bs0ladh9.jpg" alt></p>
<p>ä¸ä¸€èˆ¬ç¼–è¯‘ä¸åŒçš„æ˜¯ï¼Œåœ¨çº¢è‰²åŒºåŸŸä¼šè‡ªåŠ¨ç›‘å¬æ–‡ä»¶å˜åŒ–ã€‚</p>
<h4 id="3-2ã€åŸç†åˆ†æ"><a href="#3-2ã€åŸç†åˆ†æ" class="headerlink" title="3.2ã€åŸç†åˆ†æ"></a>3.2ã€åŸç†åˆ†æ</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (watch) &#123;</span><br><span class="line">  compiler.watch(watchOptions, callback);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  compiler.run(<span class="function">(<span class="params">err, stats</span>) =&gt;</span> &#123;</span><br><span class="line">    compiler.close(<span class="function"><span class="params">err2</span> =&gt;</span> &#123;</span><br><span class="line">      callback(err || err2, stats);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æœªå¼€å¯æ–‡ä»¶ç›‘å¬çš„åŠŸèƒ½æ—¶ï¼Œwebpack æ„å»ºèµ°çš„æ˜¯ compiler.run æ–¹æ³•ï¼Œå½“å¼€å¯æ–‡ä»¶ç›‘å¬çš„åŠŸèƒ½åï¼Œwebpack åœ¨è¿›è¡Œæ„å»ºæ—¶ä¼šèµ° compiler.watch æ–¹æ³•ã€‚</p>
<p>è€Œä¸”ä»–ä»¬æ„å»ºåçš„å†…å®¹æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯å¼€å¯æ–‡ä»¶ç›‘å¬ä¼šç›‘å¬æ–‡ä»¶å˜åŒ–è‡ªåŠ¨æ„å»ºã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¸»è¦å…³æ³¨ä¸¤ä¸ªé—®é¢˜</p>
<ul>
<li>webpack æ€ä¹ˆåšåˆ°çš„ç›‘å¬</li>
<li>ç›‘å¬åˆ°å˜åŒ–åçš„å¤„ç†æœºåˆ¶</li>
</ul>
<blockquote>
<p>ğŸ“Œ  webpack æ€ä¹ˆåšåˆ°çš„ç›‘å¬</p>
</blockquote>
<p>Webpack5 æ˜¯é€šè¿‡ node çš„ fs æ¨¡å—åˆ›å»ºç›‘å¬å™¨æ¥å®ç°æ–‡ä»¶ç›‘å¬çš„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// node_modules/watchpack/lib/watchEventSource.js</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DirectWatcher</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(filePath) &#123;</span><br><span class="line">    <span class="keyword">this</span>.filePath = filePath;</span><br><span class="line">    <span class="keyword">this</span>.watchers = <span class="keyword">new</span> <span class="built_in">Set</span>();</span><br><span class="line">    <span class="keyword">this</span>.watcher = <span class="literal">undefined</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> watcher = fs.watch(filePath);</span><br><span class="line">      <span class="keyword">this</span>.watcher = watcher;</span><br><span class="line">      watcher.on(<span class="string">"change"</span>, (type, filename) =&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> w <span class="keyword">of</span> <span class="keyword">this</span>.watchers) &#123;</span><br><span class="line">          w.emit(<span class="string">"change"</span>, type, filename);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      watcher.on(<span class="string">"error"</span>, error =&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> w <span class="keyword">of</span> <span class="keyword">this</span>.watchers) &#123;</span><br><span class="line">          w.emit(<span class="string">"error"</span>, error);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      process.nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> w <span class="keyword">of</span> <span class="keyword">this</span>.watchers) &#123;</span><br><span class="line">          w.emit(<span class="string">"error"</span>, err);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    watcherCount++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ webpack 5 ä»¥å‰ï¼Œmac ä¸Šæ–‡ä»¶ç›‘å¬ä¸ŠæŠ¥æœ‰é—®é¢˜ï¼Œè¦ä¾èµ–äº†ç¬¬ä¸‰æ–¹åŒ… chokidarï¼Œwebpack 5 å·²é‡æ„ã€‚</p>
<blockquote>
<p>ğŸ“Œ  ç›‘å¬åˆ°å˜åŒ–åçš„å¤„ç†æœºåˆ¶</p>
</blockquote>
<p>webpack åœ¨ç›‘å¬åˆ°æ–‡ä»¶å˜åŒ–åå¹¶ä¸ä¼šç«‹åˆ»å»æ„å»ºï¼Œå®ƒæœ‰ä¸€å¥—è‡ªå·±çš„å¤„ç†æœºåˆ¶ï¼Œä¸»è¦é€šè¿‡ wathcOptions çš„ poll å’Œ aggregateTimeout å±æ€§æ¥æ§åˆ¶ï¼Œpoll å±æ€§æ˜¯æ§åˆ¶å¤šé•¿æ—¶é—´å»è½®è¯¢çœ‹æ–‡ä»¶æ˜¯å¦å˜åŒ–ï¼ŒaggregateTimeout å±æ€§æ˜¯ç»è¿‡ poll å±æ€§çš„è½®è¯¢æ£€æµ‹åˆ°æ–‡ä»¶å˜åŒ–åéœ€è¦å¤šä¹…æ‰å»æ‰§è¡Œæ„å»ºã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.export = &#123;</span><br><span class="line">  watch: <span class="literal">true</span>,</span><br><span class="line">  wathcOptions: &#123; <span class="comment">// åªæœ‰å¼€å¯ç›‘å¬æ¨¡å¼æ—¶ï¼ŒwatchOptionsæ‰æœ‰æ„ä¹‰</span></span><br><span class="line">    ignored: <span class="regexp">/node_modules/</span>,</span><br><span class="line">    aggregateTimeout: <span class="number">300</span>, <span class="comment">// ç›‘å¬åˆ°å˜åŒ–å‘ç”Ÿåä¼šç­‰300mså†å»æ‰§è¡Œ</span></span><br><span class="line">    poll: <span class="number">1000</span> <span class="comment">// åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å‘ç”Ÿå˜åŒ–æ˜¯é€šè¿‡ä¸åœè¯¢é—®ç³»ç»ŸæŒ‡å®šæ–‡ä»¶æœ‰æ²¡æœ‰å˜åŒ–å®ç°çš„</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‰ã€çƒ­é‡è½½-live-reload"><a href="#ä¸‰ã€çƒ­é‡è½½-live-reload" class="headerlink" title="ä¸‰ã€çƒ­é‡è½½ live reload"></a><strong>ä¸‰ã€çƒ­é‡è½½</strong> <strong>live</strong> <strong>reload</strong></h2><p>æ–‡ä»¶ç›‘å¬çš„æ–¹å¼è™½ç„¶èƒ½è‡ªåŠ¨å¸®æˆ‘ä»¬ç¼–è¯‘ä»£ç ï¼Œä½†æ˜¯æ¯æ¬¡æ›´æ–°éƒ½éœ€è¦æ‰‹åŠ¨åˆ·æ–°æµè§ˆå™¨ï¼Œè¿™ä¸ªä½“éªŒæ˜¯éå¸¸ä¸å‹å¥½çš„ï¼Œæ‰€ä»¥ webpack åˆ©ç”¨ webpack-dev-server å®ç°äº†ä¸éœ€è¦æ‰‹åŠ¨åˆ·æ–°æµè§ˆå™¨ï¼Œç¼–è¯‘åè‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨çš„æ–¹å¼ã€‚</p>
<h3 id="1ã€ä½¿ç”¨-1"><a href="#1ã€ä½¿ç”¨-1" class="headerlink" title="1ã€ä½¿ç”¨"></a><strong>1ã€ä½¿ç”¨</strong></h3><h4 id="1-1ã€å®‰è£…ä¾èµ–-1"><a href="#1-1ã€å®‰è£…ä¾èµ–-1" class="headerlink" title="1.1ã€å®‰è£…ä¾èµ–"></a>1.1ã€å®‰è£…ä¾èµ–</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D webpack-dev-server</span><br></pre></td></tr></table></figure>
<h4 id="1-2ã€é¡¹ç›®é…ç½®-1"><a href="#1-2ã€é¡¹ç›®é…ç½®-1" class="headerlink" title="1.2ã€é¡¹ç›®é…ç½®"></a>1.2ã€é¡¹ç›®é…ç½®</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">  "build": "webpack --config build/webpack.dev.js",</span><br><span class="line">  "watch": "webpack --config build/webpack.dev.js --watch",</span><br><span class="line">  "dev": "webpack-dev-server --config build/webpack.dev.js --open"</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>å› ä¸º webpack5 é»˜è®¤ä¼šå¼€å¯çƒ­æ›´æ–°ï¼Œæ‰€ä»¥è¿™é‡Œå…ˆæ‰‹åŠ¨å…³é—­å®ƒã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">  hot: <span class="literal">false</span> <span class="comment">// ä¸º false æ—¶æ–‡ä»¶å‘ç”Ÿå˜åŒ–ä¼šåˆ·æ–°æµè§ˆå™¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-3ã€è¿è¡Œ-1"><a href="#1-3ã€è¿è¡Œ-1" class="headerlink" title="1.3ã€è¿è¡Œ"></a>1.3ã€è¿è¡Œ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn dev</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹å®Œä¿å­˜ä»£ç æµè§ˆå™¨å°±ä¼šè‡ªåŠ¨åˆ·æ–°é‡æ–°åŠ è½½ä»£ç ã€‚</p>
<h3 id="2ã€ç¼–è¯‘ç»“æœ-1"><a href="#2ã€ç¼–è¯‘ç»“æœ-1" class="headerlink" title="2ã€ç¼–è¯‘ç»“æœ"></a>2ã€<strong>ç¼–è¯‘ç»“æœ</strong></h3><p>åœ¨åŸæ¥æ„å»ºçš„åŸºç¡€ä¸Šå¤šäº†ä¸¤ä¸ªæ¨¡å—ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__webpack_require__(<span class="string">"./node_modules/webpack-dev-server/client/index.js?protocol=ws%3A&amp;hostname=0.0.0.0&amp;port=8080&amp;pathname=%2Fws&amp;logging=info&amp;reconnect=10"</span>);</span><br><span class="line"><span class="comment">/******/</span>         </span><br><span class="line">__webpack_require__(<span class="string">"./node_modules/webpack/hot/dev-server.js"</span>);</span><br></pre></td></tr></table></figure>
<h3 id="3ã€å®ç°åŸç†-1"><a href="#3ã€å®ç°åŸç†-1" class="headerlink" title="3ã€å®ç°åŸç†"></a><strong>3ã€å®ç°åŸç†</strong></h3><h4 id="3-1ã€æ‰§è¡Œè¿‡ç¨‹-1"><a href="#3-1ã€æ‰§è¡Œè¿‡ç¨‹-1" class="headerlink" title="3.1ã€æ‰§è¡Œè¿‡ç¨‹"></a>3.1ã€æ‰§è¡Œè¿‡ç¨‹</h4><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h6hu537c7wj21ik0mhdij.jpg" alt></p>
<h4 id="3-2ã€åŸç†åˆ†æ-1"><a href="#3-2ã€åŸç†åˆ†æ-1" class="headerlink" title="3.2ã€åŸç†åˆ†æ"></a>3.2ã€åŸç†åˆ†æ</h4><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦å…³æ³¨ä¸‰ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>çƒ­é‡è½½å’Œæ–‡ä»¶ç›‘å¬ç›¸æ¯”ï¼Œæ„å»ºçš„å·®å¼‚æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>æµè§ˆå™¨å’ŒæœåŠ¡ç«¯æ€ä¹ˆåšçš„é€šè®¯ï¼Ÿå…·ä½“åœ¨ä¼ é€’ä»€ä¹ˆä¿¡æ¯ï¼Ÿ</li>
<li>æµè§ˆå™¨æ€ä¹ˆåšåˆ°çš„æ›´æ–°ï¼Ÿ</li>
</ul>
<p>çƒ­é‡è½½å’Œæ–‡ä»¶ç›‘å¬ç›¸æ¯”ï¼Œæ„å»ºçš„å·®å¼‚æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>ç›¸æ¯”è¾ƒæ–‡ä»¶ç›‘å¬ï¼Œçƒ­é‡è½½ä¼šé€šè¿‡ webpack-dev-server è°ƒç”¨ express èµ·äº†ä¸€ä¸ª node æœåŠ¡ã€‚</p>
<p>ç„¶ååˆ›å»º <em>Compiler</em> <em>å®ä¾‹ï¼Œä¹‹åä¹Ÿä¼šèµ°</em> <em>Compiler.watch</em> <em>æ–¹æ³•æ‰§è¡Œæ„å»ºã€‚</em></p>
<p><em>ä¸åŒçš„æ˜¯ç¼–è¯‘åçš„å†…å®¹æ²¡æœ‰è¾“å‡ºåˆ°ç£ç›˜ï¼Œè€Œæ˜¯è¾“å‡ºåˆ°äº†å†…å­˜</em>ï¼Œæä¾›ä¸€ä¸ªåœ°å€å»è®©ä½ è®¿é—®ã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/jpeg/10367031/1659883287850-6fc6c9b9-8b40-48be-9cf9-f118a3acae7b.jpeg" alt="img"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">"express"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** <span class="doctag">@typedef <span class="type">&#123;import("webpack").Compiler&#125;</span> </span>Compiler */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(options = &#123;&#125;, compiler) &#123;</span><br><span class="line">    <span class="keyword">this</span>.compiler = <span class="comment">/** @type &#123;Compiler | MultiCompiler&#125; */</span> (compiler);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  setupApp() &#123;</span><br><span class="line">    <span class="comment">/** <span class="doctag">@type <span class="type">&#123;import("express").Application | undefined&#125;</span></span>*/</span></span><br><span class="line">    <span class="comment">// eslint-disable-next-line new-cap</span></span><br><span class="line">    <span class="keyword">this</span>.app = <span class="keyword">new</span> <span class="comment">/** <span class="doctag">@type <span class="type">&#123;any&#125;</span> </span>*/</span> (express)();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  setupDevMiddleware() &#123;</span><br><span class="line">    <span class="keyword">const</span> webpackDevMiddleware = <span class="built_in">require</span>(<span class="string">"webpack-dev-middleware"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// middleware for serving webpack bundle</span></span><br><span class="line">    <span class="keyword">this</span>.middleware = webpackDevMiddleware(</span><br><span class="line">      <span class="keyword">this</span>.compiler,</span><br><span class="line">      <span class="keyword">this</span>.options.devMiddleware</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">async</span> start() &#123;</span><br><span class="line">    <span class="keyword">const</span> listenOptions = <span class="keyword">this</span>.options.ipc</span><br><span class="line">      ? &#123; <span class="attr">path</span>: <span class="keyword">this</span>.options.ipc &#125;</span><br><span class="line">      : &#123; <span class="attr">host</span>: <span class="keyword">this</span>.options.host, <span class="attr">port</span>: <span class="keyword">this</span>.options.port &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> <span class="comment">/** <span class="doctag">@type <span class="type">&#123;Promise&lt;void&gt;&#125;</span> </span>*/</span> (</span><br><span class="line">      <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">/** <span class="doctag">@type <span class="type">&#123;import("http").Server&#125;</span> </span>*/</span></span><br><span class="line">        (<span class="keyword">this</span>.server).listen(listenOptions, () =&gt; &#123;</span><br><span class="line">          resolve();</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line">  <span class="keyword">async</span> initialize() &#123;</span><br><span class="line">    <span class="keyword">this</span>.setupHooks();</span><br><span class="line">    <span class="keyword">this</span>.setupApp();</span><br><span class="line">    <span class="keyword">this</span>.setupHostHeaderCheck();</span><br><span class="line">    <span class="keyword">this</span>.setupDevMiddleware();</span><br><span class="line">    <span class="comment">// Should be after `webpack-dev-middleware`, otherwise other middlewares might rewrite response</span></span><br><span class="line">    <span class="keyword">this</span>.setupBuiltInRoutes();</span><br><span class="line">    <span class="keyword">this</span>.setupWatchFiles();</span><br><span class="line">    <span class="keyword">this</span>.setupWatchStaticFiles();</span><br><span class="line">    <span class="keyword">this</span>.setupMiddlewares();</span><br><span class="line">    <span class="keyword">this</span>.createServer();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµè§ˆå™¨å’ŒæœåŠ¡ç«¯æ€ä¹ˆåšçš„é€šè®¯ï¼Ÿå…·ä½“åœ¨ä¼ é€’ä»€ä¹ˆä¿¡æ¯ï¼Ÿ</p>
<p>è®¿é—® webpack æä¾›çš„åœ°å€ï¼Œæ‰“å¼€æ§åˆ¶å°å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´æœ‰å»ºç«‹ websocket é€šä¿¡çš„ä¿¡æ¯ï¼Œä½†æ˜¯æˆ‘ä»¬å¼€å‘çš„æ—¶å€™ä»£ç é‡Œå¹¶æ²¡æœ‰åšè¿™äº›é¢å¤–çš„äº‹æƒ…ã€‚æˆ‘ä»¬å°±éœ€è¦å»çœ‹ webpack æ˜¯åœ¨å“ªé‡Œåšçš„è¿™äº›äº‹ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h6hu5zn09xj21a60u0q5y.jpg" alt></p>
<p>é€šè¿‡æ¢å¯»æˆ‘ä»¬å¯ä»¥åœ¨å‘ç° webpack åœ¨å¼€å¯æœ¬åœ°æœåŠ¡å‰å¯¹ webpack çš„é…ç½®å…¥å£åšäº†ä¿®æ”¹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ·»åŠ  client socket ä»£ç </span></span><br><span class="line">additionalEntries.push(<span class="string">`<span class="subst">$&#123;<span class="built_in">require</span>.resolve(<span class="string">"../client/index.js"</span>)&#125;</span>?<span class="subst">$&#123;webSocketURLStr&#125;</span>`</span>);</span><br><span class="line">  </span><br><span class="line"><span class="comment">// æ·»åŠ  webpack dev-server ä»£ç </span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.options.hot === <span class="string">"only"</span>) &#123;</span><br><span class="line">  additionalEntries.push(<span class="built_in">require</span>.resolve(<span class="string">"webpack/hot/only-dev-server"</span>));</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.options.hot) &#123;</span><br><span class="line">  additionalEntries.push(<span class="built_in">require</span>.resolve(<span class="string">"webpack/hot/dev-server"</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> webpack = compiler.webpack || <span class="built_in">require</span>(<span class="string">"webpack"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•å…¥ä¸€äº›éœ€è¦é¢å¤–æ‰“åŒ…çš„å†…å®¹</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> webpack.EntryPlugin !== <span class="string">"undefined"</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> additionalEntry <span class="keyword">of</span> additionalEntries) &#123;</span><br><span class="line">    <span class="keyword">new</span> webpack.EntryPlugin(compiler.context, additionalEntry, &#123;</span><br><span class="line">      name: <span class="literal">undefined</span>,</span><br><span class="line">    &#125;).apply(compiler);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œ webpack å¸®æˆ‘ä»¬çš„å…¥å£åˆå¼•å…¥äº†ä¸¤ä¸ªé¢å¤–çš„ module æ¥æ‰“åŒ…ï¼Œå…¶ä¸­å¼•å…¥çš„ç¬¬ä¸€ä¸ª module æ˜¯ä¸æœåŠ¡ç«¯å»ºç«‹ websocket è¿æ¥ç”¨çš„ï¼Œç¬¬äºŒä¸ª module å°±æ˜¯å®¢æˆ·ç«¯åœ¨æ¥æ”¶åˆ°æ–‡ä»¶å˜åŒ–çš„é€šçŸ¥ååšå¤„ç†ç”¨çš„ã€‚</p>
<p>æ‰€ä»¥æµè§ˆå™¨ä¹‹æ‰€ä»¥èƒ½æ„Ÿåº”åˆ°æœ¬åœ°æ–‡ä»¶å˜åŒ–æ˜¯æœ¬åœ°æœåŠ¡ä¸»åŠ¨æ¨é€çš„ç¼˜æ•…ã€‚å…·ä½“æ˜¯æœåŠ¡ç«¯åœ¨ç›‘å¬åˆ°æ–‡ä»¶å˜åŒ–åä¼šå‘å®¢æˆ·ç«¯å‘é€ hash äº‹ä»¶å’Œ ok çš„äº‹ä»¶ã€‚hash äº‹ä»¶ä¸»è¦è¿”å›ä¸€ä¸ª hash å€¼ï¼Œç”¨æ¥å¯¹æ¯æ¬¡çš„ç¼–è¯‘ç»“æœåšæ ‡è¯†ï¼Œok äº‹ä»¶æ˜¯é€šçŸ¥æµè§ˆå™¨è¿›è¡Œçƒ­é‡è½½ç”¨çš„ã€‚</p>
<p>hash äº‹ä»¶æ˜¯å•¥å…·ä½“ä¸‹é¢çƒ­æ›´æ–°ä¼šè¯´</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sendStats(clients, stats, force) &#123;</span><br><span class="line">  <span class="keyword">this</span>.sendMessage(clients, <span class="string">"hash"</span>, stats.hash);</span><br><span class="line">  <span class="keyword">this</span>.sendMessage(clients, <span class="string">"ok"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµè§ˆå™¨æ€ä¹ˆåšåˆ°çš„æ›´æ–°ï¼Ÿ</p>
<p>å½“æ£€æµ‹åˆ°éœ€è¦æ›´æ–°æ—¶å°±è°ƒç”¨ reloadApp åˆ·æ–°æµè§ˆå™¨è¯·æ±‚æœ€æ–°çš„èµ„æºï¼Œå…¶ä¸­å…³é”®çš„ä»£ç æ˜¯ <em>window</em>.location.reload()ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæµè§ˆå™¨ä¼šè‡ªåŠ¨åˆ·æ–°çš„ç¼˜æ•…ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reloadApp</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (liveReload &amp;&amp; allowToLiveReload) &#123;</span><br><span class="line">    <span class="keyword">var</span> rootWindow = self; <span class="comment">// use parent window for reload (in case we're in an iframe with no valid src)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> intervalId = self.setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (rootWindow.location.protocol !== <span class="string">"about:"</span>) &#123;</span><br><span class="line">        <span class="comment">// reload immediately if protocol is valid</span></span><br><span class="line">        applyReload(rootWindow, intervalId);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        rootWindow = rootWindow.parent;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (rootWindow.parent === rootWindow) &#123;</span><br><span class="line">          <span class="comment">// if parent equals current window we've reached the root which would continue forever, so trigger a reload anyways</span></span><br><span class="line">          applyReload(rootWindow, intervalId);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">applyReload</span>(<span class="params">rootWindow, intervalId</span>) </span>&#123;</span><br><span class="line">    clearInterval(intervalId);</span><br><span class="line">    log.info(<span class="string">"App updated. Reloading..."</span>);</span><br><span class="line">    rootWindow.location.reload();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2 id="å››ã€çƒ­æ›´æ–°-HMRï¼ˆçƒ­æ›¿æ¢ï¼‰"><a href="#å››ã€çƒ­æ›´æ–°-HMRï¼ˆçƒ­æ›¿æ¢ï¼‰" class="headerlink" title="å››ã€çƒ­æ›´æ–° HMRï¼ˆçƒ­æ›¿æ¢ï¼‰"></a><strong>å››ã€çƒ­æ›´æ–° HMRï¼ˆçƒ­æ›¿æ¢ï¼‰</strong></h2><p>ä¸Šé¢ä»‹ç»çš„çƒ­é‡è½½è™½ç„¶åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜äº†å¼€å‘æ•ˆç‡ï¼Œæ»¡è¶³äº†æˆ‘ä»¬çš„åŸºæœ¬å¼€å‘è¯‰æ±‚ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªç—›ç‚¹å°±æ˜¯ä¸èƒ½åœ¨æ¥æ”¶å˜åŒ–åä¿ç•™ä¹‹å‰çš„çŠ¶æ€åšå±€éƒ¨æ›´æ–°ï¼Œè¿™æ ·åœ¨æµ‹è¯•ä¸€äº›åŠŸèƒ½çš„æ—¶å€™ï¼Œæ¯”å¦‚è¾“å…¥æ¡†è¾“å…¥ä¸€äº›æ•°æ®åæ‰èƒ½åšç‚¹å‡»çš„æµ‹è¯•ï¼Œé‚£æˆ‘ä»¬æ¯æ¬¡æ›´æ–°å®Œå°±å¿…é¡»é‡æ–°è¾“ä¸€éå†å¼€å§‹æµ‹è¯•ï¼Œè¿™æ˜¯éå¸¸ä½æ•ˆçš„ï¼Œçƒ­æ›´æ–°å°±å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p>
<h3 id="1ã€ä½¿ç”¨-2"><a href="#1ã€ä½¿ç”¨-2" class="headerlink" title="1ã€ä½¿ç”¨"></a><strong>1ã€ä½¿ç”¨</strong></h3><h4 id="1-1ã€å®‰è£…ä¾èµ–-2"><a href="#1-1ã€å®‰è£…ä¾èµ–-2" class="headerlink" title="1.1ã€å®‰è£…ä¾èµ–"></a>1.1ã€å®‰è£…ä¾èµ–</h4><p>åŒä¸Š</p>
<h4 id="1-2ã€é¡¹ç›®é…ç½®-2"><a href="#1-2ã€é¡¹ç›®é…ç½®-2" class="headerlink" title="1.2ã€é¡¹ç›®é…ç½®"></a>1.2ã€é¡¹ç›®é…ç½®</h4><p>å°† hot çš„å€¼ä¿®æ”¹ä¸º true æˆ–å»æ‰è¯¥é…ç½®ï¼ˆé»˜è®¤å€¼ trueï¼‰ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">  hot: <span class="literal">true</span> <span class="comment">// ä¸º false æ—¶æ–‡ä»¶å‘ç”Ÿå˜åŒ–ä¼šåˆ·æ–°æµè§ˆå™¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-3ã€è¿è¡Œ-2"><a href="#1-3ã€è¿è¡Œ-2" class="headerlink" title="1.3ã€è¿è¡Œ"></a>1.3ã€è¿è¡Œ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn dev</span><br></pre></td></tr></table></figure>
<h3 id="2ã€ç¼–è¯‘ç»“æœ-2"><a href="#2ã€ç¼–è¯‘ç»“æœ-2" class="headerlink" title="2ã€ç¼–è¯‘ç»“æœ"></a>2ã€<strong>ç¼–è¯‘ç»“æœ</strong></h3><p>åŒä¸Š</p>
<h3 id="3ã€å®ç°åŸç†-2"><a href="#3ã€å®ç°åŸç†-2" class="headerlink" title="3ã€å®ç°åŸç†"></a><strong>3ã€å®ç°åŸç†</strong></h3><h4 id="3-1ã€æ‰§è¡Œè¿‡ç¨‹-2"><a href="#3-1ã€æ‰§è¡Œè¿‡ç¨‹-2" class="headerlink" title="3.1ã€æ‰§è¡Œè¿‡ç¨‹"></a>3.1ã€æ‰§è¡Œè¿‡ç¨‹</h4><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h6hu537c7wj21ik0mhdij.jpg" alt></p>
<h4 id="3-2ã€åŸç†åˆ†æ-2"><a href="#3-2ã€åŸç†åˆ†æ-2" class="headerlink" title="3.2ã€åŸç†åˆ†æ"></a>3.2ã€åŸç†åˆ†æ</h4><p>è¿™é‡Œä¸»è¦å…³æ³¨ä¸¤ä¸ªé—®é¢˜æ˜¯ï¼š</p>
<ul>
<li>å’Œçƒ­é‡è½½ç›¸æ¯”ï¼Œçƒ­æ›´æ–°ç¼–è¯‘çš„å·®å¼‚æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>æµè§ˆå™¨åœ¨ç›‘å¬åˆ°æ–‡ä»¶å˜åŒ–ååšäº†ä»€ä¹ˆäº‹æƒ…ï¼Ÿ</li>
</ul>
<p>å’Œçƒ­é‡è½½ç›¸æ¯”ï¼Œçƒ­æ›´æ–°ç¼–è¯‘çš„å·®å¼‚æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>å®ä¾‹åŒ– HotModuleReplacementPlugin æ’ä»¶ï¼Œå¹¶ç›‘å¬å¯¹åº”çš„ hooksã€‚</p>
<p>webpack4 éœ€è¦æ‰‹åŠ¨å¼•å…¥</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> plugin = <span class="keyword">new</span> webpack.HotModuleReplacementPlugin();</span><br><span class="line"></span><br><span class="line">plugin.apply(compiler);</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆä¼šå®šä¹‰ module.hot ç›¸å…³ api çš„ dependency ä»¥åŠ template</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HotModuleReplacementPlugin</span> </span>&#123;</span><br><span class="line">  apply(compiler) &#123;</span><br><span class="line">    compiler.hooks.compilation.tap(</span><br><span class="line">      <span class="string">"HotModuleReplacementPlugin"</span>,</span><br><span class="line">      (compilation, &#123; normalModuleFactory &#125;) =&gt; &#123;</span><br><span class="line">        <span class="comment">//#region module.hot.* API</span></span><br><span class="line">        compilation.dependencyFactories.set(</span><br><span class="line">          ModuleHotAcceptDependency,</span><br><span class="line">          normalModuleFactory</span><br><span class="line">        );</span><br><span class="line">        compilation.dependencyTemplates.set(</span><br><span class="line">          ModuleHotAcceptDependency,</span><br><span class="line">          <span class="keyword">new</span> ModuleHotAcceptDependency.Template()</span><br><span class="line">        );</span><br><span class="line">        compilation.dependencyFactories.set(</span><br><span class="line">          ModuleHotDeclineDependency,</span><br><span class="line">          normalModuleFactory</span><br><span class="line">        );</span><br><span class="line">        compilation.dependencyTemplates.set(</span><br><span class="line">          ModuleHotDeclineDependency,</span><br><span class="line">          <span class="keyword">new</span> ModuleHotDeclineDependency.Template()</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åç›‘å¬parseré˜¶æ®µï¼Œå¯¹module.hotç­‰apiè¿›è¡Œè§£æï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">parser.hooks.call</span><br><span class="line">  .for(<span class="string">"module.hot.accept"</span>)</span><br><span class="line">  .tap(</span><br><span class="line">  <span class="string">"HotModuleReplacementPlugin"</span>,</span><br><span class="line">  createAcceptHandler(parser, ModuleHotAcceptDependency)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>å› æ­¤module.hotç­‰apiç»è¿‡parseråä¼šå˜ä¸ºç›¸åº”çš„dependencyã€‚åœ¨code generateæ—¶ï¼Œè°ƒç”¨å¯¹åº”çš„templateç”Ÿæˆæ–°çš„ä»£ç </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è½¬æ¢å‰</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">  <span class="built_in">module</span>.hot.accept([<span class="string">'./moduleB.js'</span>], () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'======&gt;  accept B'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è½¬æ¢å</span></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="built_in">module</span>.hot.accept([<span class="comment">/*! ./moduleB.js */</span> <span class="string">"./src/moduleB.js"</span>], __WEBPACK_OUTDATED_DEPENDENCIES__ =&gt; &#123; </span><br><span class="line">    <span class="comment">/* harmony import */</span> _moduleB__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(<span class="comment">/*! ./moduleB.js */</span> <span class="string">"./src/moduleB.js"</span>);</span><br><span class="line">    (<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'======&gt;  accept B'</span>)</span><br><span class="line">    &#125;)(__WEBPACK_OUTDATED_DEPENDENCIES__); </span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµè§ˆå™¨åœ¨ç›‘å¬åˆ°æ–‡ä»¶å˜åŒ–ååšäº†ä»€ä¹ˆäº‹æƒ…ï¼Ÿ</p>
<p>è¦çŸ¥é“æµè§ˆå™¨åœ¨ç›‘å¬åˆ°æ–‡ä»¶å˜åŒ–ååšäº†ä»€ä¹ˆäº‹æƒ…è¦å…ˆå›åˆ°æœåŠ¡ç«¯ç›‘å¬åˆ°æ–‡ä»¶å˜åŒ–ç»™å®¢æˆ·ç«¯å‘é€ hash äº‹ä»¶å’Œ ok çš„äº‹ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬å…ˆçœ‹ hash äº‹ä»¶å…·ä½“åšäº†ä»€ä¹ˆã€‚</p>
<p>åˆšæ‰“å¼€é¡µé¢æ—¶</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h6hu74019yj21ik0aujtd.jpg" alt></p>
<p>ä¿®æ”¹ä»£ç ä¿å­˜å</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h6hu7c4rzlj21ik0dtq5k.jpg" alt></p>
<p>è§‚å¯Ÿå¯ä»¥å‘ç°ä¿®æ”¹å®Œä»£ç åï¼Œæµè§ˆå™¨æ–°åŠ è½½çš„æ–‡ä»¶åç¼€æ˜¯ä¸Šæ¬¡çš„ hashï¼Œæ‰€ä»¥ Hash å€¼ä»£è¡¨æ¯ä¸€æ¬¡ç¼–è¯‘çš„æ ‡è¯†ï¼Œä¸Šæ¬¡è¾“å‡ºçš„ Hash å€¼ä¼šä½œä¸ºæœ¬æ¬¡ç¼–è¯‘æ–°ç”Ÿæˆçš„æ–‡ä»¶æ ‡è¯†ã€‚</p>
<p>çŸ¥é“äº† hash äº‹ä»¶çš„æ¦‚å¿µåï¼Œæˆ‘ä»¬å†å›åˆ°æœåŠ¡ç«¯å‘æµè§ˆå™¨å‘é€ hash äº‹ä»¶å’Œ ok äº‹ä»¶ï¼Œæµè§ˆå™¨ä¼šè°ƒç”¨ reloadApp æ–¹æ³•ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// node_modules/webpack-dev-server/client/index.js</span></span><br><span class="line"><span class="keyword">var</span> onSocketMessage = &#123;</span><br><span class="line">  hash: <span class="function"><span class="keyword">function</span> <span class="title">hash</span>(<span class="params">_hash</span>) </span>&#123;</span><br><span class="line">    status.previousHash = status.currentHash;</span><br><span class="line">    status.currentHash = _hash;</span><br><span class="line">  &#125;,</span><br><span class="line">  ok: <span class="function"><span class="keyword">function</span> <span class="title">ok</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    sendMessage(<span class="string">"Ok"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (options.overlay) &#123;</span><br><span class="line">      hide();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    reloadApp(options, status);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reloadApp</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (hot &amp;&amp; allowToHot) &#123;</span><br><span class="line">    log.info(<span class="string">"App hot update..."</span>);</span><br><span class="line">    hotEmitter.emit(<span class="string">"webpackHotUpdate"</span>, status.currentHash);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> self !== <span class="string">"undefined"</span> &amp;&amp; self.window) &#123;</span><br><span class="line">      <span class="comment">// broadcast update to window</span></span><br><span class="line">      self.postMessage(<span class="string">"webpackHotUpdate"</span>.concat(status.currentHash), <span class="string">"*"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (liveReload &amp;&amp; allowToLiveReload) &#123;</span><br><span class="line">    <span class="built_in">window</span>.location.reload();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¥ç€è§¦å‘ webpackHotUpdate äº‹ä»¶ï¼Œç»è¿‡ä¸€ç³»åˆ—çš„æ£€æŸ¥åæ ¹æ®ä¸Šæ¬¡çš„ hash å€¼å‘é€ fetch è¯·æ±‚è·å–éœ€è¦æ›´æ–°çš„æ¨¡å—åã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/10367031/1659883436219-7d07db68-e11c-4f4b-aba6-390a822e09c2.png" alt="img"></p>
<p>å†é€šè¿‡ JSONP çš„æ–¹å¼è¯·æ±‚è¿™ä¸ªæ–°çš„æ¨¡å—ï¼Œå¹¶æ‰§è¡Œç›¸å…³æ¨¡å—çš„ä»£ç ï¼Œè¿™å°±èµ·åˆ°äº†å±€éƒ¨æ›´æ–°çš„ä½œç”¨ã€‚</p>
<h2 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a><strong>äº”ã€æ€»ç»“</strong></h2><p>webpack compiler å¯¹æ–‡ä»¶è¿›è¡Œæ‰“åŒ…ï¼Œæ‰“åŒ…å¥½åæŠŠç¼–è¯‘å¥½çš„æ–‡ä»¶ä¼ è¾“ç»™ bundleServerï¼Œ bundleServer å°±ä»¥æœåŠ¡å™¨çš„æ–¹å¼è®©æµè§ˆå™¨è®¿é—®ã€‚ï¼ˆ1-2-A-Bï¼‰</p>
<p>æ–‡ä»¶å‘ç”Ÿå˜åŒ–åï¼Œä¼šå†ç»è¿‡ webpack compiler è¿›è¡Œç¼–è¯‘ï¼Œç¼–è¯‘åå°†ä»£ç å‘é€ç»™ HMR Serverï¼ŒHMR Server çŸ¥é“å“ªäº›æ¨¡å—å‘ç”Ÿäº†æ”¹å˜ï¼Œç„¶å HMR server ä¼šä»¥ websocket çš„æ–¹å¼é€šçŸ¥ HRM Runtimeï¼ŒHRM Runtime é€šè¿‡ JSONP çš„æ–¹å¼è·å–æ›´æ–°çš„å†…å®¹ï¼Œæœ€å HMR runtime ä¼šæ ¹æ®è¿”å›çš„æ–°æ¨¡å—ä»£ç åšè¿›ä¸€æ­¥å¤„ç†ï¼Œå¯èƒ½æ˜¯åˆ·æ–°é¡µé¢ï¼Œä¹Ÿå¯èƒ½æ˜¯å¯¹æ¨¡å—è¿›è¡Œçƒ­æ›´æ–°ã€‚ï¼ˆ1-2-3-4ï¼‰</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h6hu537c7wj21ik0mhdij.jpg" alt></p>
<h2 id="å…­ã€æ€è€ƒ"><a href="#å…­ã€æ€è€ƒ" class="headerlink" title="å…­ã€æ€è€ƒ"></a>å…­ã€æ€è€ƒ</h2><h3 id="1ã€æ„å»ºå·¥å…·çƒ­æ›´æ–°èƒ½åŠ›å¯¹æ¯”"><a href="#1ã€æ„å»ºå·¥å…·çƒ­æ›´æ–°èƒ½åŠ›å¯¹æ¯”" class="headerlink" title="1ã€æ„å»ºå·¥å…·çƒ­æ›´æ–°èƒ½åŠ›å¯¹æ¯”"></a>1ã€æ„å»ºå·¥å…·çƒ­æ›´æ–°èƒ½åŠ›å¯¹æ¯”</h3><p>gulpï¼šæ”¯æŒçƒ­é‡è½½ï¼Œçƒ­æ›´æ–°ç›®å‰æ²¡å‘ç°æ”¯æŒç‰¹åˆ«å¥½çš„åŒ…ï¼Œéœ€è¦è‡ªå·±å®ç°ã€‚</p>
<table>
<thead>
<tr>
<th>å·¥å…·</th>
<th>webpack</th>
<th>vite</th>
</tr>
</thead>
<tbody>
<tr>
<td>é…ç½®</td>
<td>ç®€å•</td>
<td>ç®€å•</td>
</tr>
<tr>
<td>å®ç°åŸç†</td>
<td>webpack4 æ–‡ä»¶ç›‘å¬ç”¨çš„ chokidarï¼Œwebpack5 ç”¨çš„ fs.watchwebpack4 ä¾èµ– vue-hot-reload-api å®ç°æ¨¡å—çƒ­æ›¿æ¢ï¼Œwebpack5 è‡ªå·±å®ç°åŸºäºbundleè¿›è¡Œæ„å»º</td>
<td>vite2 æ–‡ä»¶ç›‘å¬ç”¨çš„ chokidarvite2 ä¾èµ– vue-hot-reload-api å®ç°æ¨¡å—çƒ­æ›¿æ¢åŸºäºbundlelessè¿›è¡Œæ„å»º</td>
</tr>
<tr>
<td>é€Ÿåº¦</td>
<td>å†·å¯åŠ¨æ—¶é—´é•¿çƒ­æ›´æ–°èƒ½åŠ›å—é¡¹ç›®ä½“ç§¯çš„å½±å“</td>
<td>å†·å¯åŠ¨æ—¶é—´çŸ­çƒ­æ›´æ–°èƒ½åŠ›ä¸å—é¡¹ç›®ä½“ç§¯çš„å½±å“</td>
</tr>
<tr>
<td>ä½¿ç”¨åœºæ™¯</td>
<td>å¯¹æ„å»ºå†…å®¹æœ‰ä¸¥æ ¼è¦æ±‚ä¸”æ„å»ºç»“æœä¸å¹³å°æ¶æ„å…³ç³»ç´§å¯†</td>
<td>å¯¹æ„å»ºå†…å®¹æ— ä¸¥æ ¼è¦æ±‚</td>
</tr>
</tbody>
</table>
<h2 id="ä¸ƒã€é¡¹ç›®åœ°å€"><a href="#ä¸ƒã€é¡¹ç›®åœ°å€" class="headerlink" title="ä¸ƒã€é¡¹ç›®åœ°å€"></a><strong>ä¸ƒã€é¡¹ç›®åœ°å€</strong></h2><p><a href="https://github.com/Yin-Hongwei/webpack-hmr-demo" target="_blank" rel="noopener">https://github.com/Yin-Hongwei/webpack-hmr-demo</a></p>
<div class="qr-code"></div><img class="qrcode-img" src="/img/weixin.jpg"><div class="qrcode-desc">å¾®ä¿¡æ‰“èµ</div><div class="post-tag-list">æ ‡ç­¾: <a class="post-tags" href="/tags/webpack/">webpack</a></div><nav id="pagination"><div class="next-post pull-right"><a href="/2021/12/04/Vue watcher åˆ†ç±»/"><span>Vue watcher åˆ†ç±»</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: 'e238e2d1f25ec6e15026',
  clientSecret: '3c4e537d46a59d056e6c0cc478b04784defafcfb',
  repo: 'Yin-Hongwei.github.io',
  owner: 'Yin-Hongwei',
  admin: 'Yin-Hongwei',
  id: md5(window.location.pathname)
})
gitalk.render('gitalk-container')</script></article></section></article><footer id="footer-outer"><div id="footer-inner"><p class="footer-text">Copyright &copy; 2018-2023 Yin-Hongwei</p></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i></body><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="/js/utils.js" defer></script><script src="/js/transition.js" defer></script><script src="/js/fancybox.js" defer></script><script src="/js/menu.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/scroll.js" defer></script></html>