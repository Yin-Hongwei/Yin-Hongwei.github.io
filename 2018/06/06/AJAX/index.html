<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="AJAX å›è°ƒåœ°ç‹±å’Œè·¨åŸŸçš„è§£å†³"><meta name="keywords" content="JavaScript"><meta name="author" content="Yin-Hongwei"><meta name="copyright" content="Yin-Hongwei"><title>AJAX å›è°ƒåœ°ç‹±å’Œè·¨åŸŸçš„è§£å†³ | Hongwei Blog</title><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script></head><body><header id="header"><nav id="navbar"><span class="nav-left"><div class="tou-img"><img src="/img/tou.jpg"></div><a id="site-name" href="/">Hongwei Blog</a></span><i class="fa fa-bars toggle-menu nav-right" aria-hidden="true"></i><span class="nav-right menus"><a class="site-page" href="/about">å…³äº</a><a class="site-page" href="/archives">å­˜æ¡£</a><a class="site-page" href="/tags">æ ‡ç­¾</a></span></nav></header><article id="content-outer"><section id="content-inner"><article class="article-entry" id="post"><h1>AJAX å›è°ƒåœ°ç‹±å’Œè·¨åŸŸçš„è§£å†³</h1><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>æœ¬æ–‡ä¸»è¦ä»‹ç»AJAXçš„ä½¿ç”¨åŠå›è°ƒåœ°ç‹±å’Œè·¨åŸŸçš„è§£å†³ã€‚ğŸ˜„</p>
<a id="more"></a>
<h2 id="ä¸€-AJAX"><a href="#ä¸€-AJAX" class="headerlink" title="ä¸€ AJAX"></a>ä¸€ AJAX</h2><p>Ajax é€šè¿‡ XMLHttpRequest å¯¹è±¡èƒ½å¤Ÿä¸è¿œç¨‹çš„æœåŠ¡å™¨è¿›è¡Œä¿¡æ¯äº¤äº’ã€‚åœ¨éœ€è¦å‘é€å¤šä¸ªå¼‚æ­¥è¯·æ±‚ï¼Œå¹¶ä¸”æ¯ä¸ªè¯·æ±‚ä¹‹é—´éœ€è¦ç›¸äº’ä¾èµ–çš„æ—¶å€™ï¼Œå®ƒè¿”å›çš„é¡ºåºä¸ç¡®å®šï¼Œæœ‰æ—¶å€™å¾—ä¸åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œå¦‚æœæƒ³è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™è¦æŠŠä¸‹ä¸€ä¸ªè¯·æ±‚å†™åˆ°ä¸Šä¸€ä¸ªè¯·æ±‚çš„å›è°ƒå‡½æ•°é‡Œï¼Œå³åµŒå¥—æ–¹å¼æ¥è§£å†³ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">doSomething(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">  doSomethingElse(result, <span class="function"><span class="keyword">function</span>(<span class="params">newResult</span>) </span>&#123;</span><br><span class="line">    doThirdThing(newResult, <span class="function"><span class="keyword">function</span>(<span class="params">finalResult</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Got the final result: '</span> + finalResult);</span><br><span class="line">    &#125;, failureCallback);</span><br><span class="line">  &#125;, failureCallback);</span><br><span class="line">&#125;, failureCallback);</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯è¿™æ ·ä¸€å±‚ä¸€å±‚çš„åµŒå¥—ï¼Œä½¿å›è°ƒå‡½æ•°çš„å±‚çº§è¶Šæ¥è¶Šå¤šï¼Œå¾ˆå¯èƒ½å å…¥å›è°ƒåœ°ç‹±ä¸­ï¼Œç»´æŠ¤å›°éš¾ã€‚ä¸ºäº†è§£å†³è¿™ç§å›è°ƒé¡ºåºçš„ä¸ç¡®å®šæ€§ï¼Œä»¥åŠå›è°ƒåœ°ç‹±ï¼Œäºæ˜¯å‡ºç°äº† <strong>Promise</strong>ã€‚</p>
<h2 id="äºŒ-Promise"><a href="#äºŒ-Promise" class="headerlink" title="äºŒ Promise"></a>äºŒ Promise</h2><h3 id="1-æ¦‚å¿µ"><a href="#1-æ¦‚å¿µ" class="headerlink" title="1.æ¦‚å¿µ"></a>1.æ¦‚å¿µ</h3><h4 id="1ï¼‰å«ä¹‰"><a href="#1ï¼‰å«ä¹‰" class="headerlink" title="1ï¼‰å«ä¹‰"></a>1ï¼‰å«ä¹‰</h4><p>Promise æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‡Œé¢ä¿å­˜ç€æŸä¸ªæœªæ¥æ‰ä¼šç»“æŸçš„äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼‰çš„ç»“æœã€‚å®ƒå°†å¼‚æ­¥æ“ä½œä»¥åŒæ­¥æ“ä½œçš„æµç¨‹è¡¨è¾¾å‡ºæ¥ï¼Œé¿å…äº†å±‚å±‚åµŒå¥—çš„å›è°ƒå‡½æ•°ã€‚</p>
<h4 id="2ï¼‰ç‰¹ç‚¹"><a href="#2ï¼‰ç‰¹ç‚¹" class="headerlink" title="2ï¼‰ç‰¹ç‚¹"></a>2ï¼‰ç‰¹ç‚¹</h4><ul>
<li>å¯¹è±¡çš„çŠ¶æ€ä¸å—å¤–ç•Œå½±å“ã€‚<code>Promise</code>å¯¹è±¡ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼š<code>pending</code>ï¼ˆè¿›è¡Œä¸­ï¼‰ã€<code>fulfilled</code>ï¼ˆå·²æˆåŠŸï¼‰å’Œ<code>rejected</code>ï¼ˆå·²å¤±è´¥ï¼‰ã€‚åªæœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœå¯ä»¥å†³å®šå½“å‰æ˜¯å“ªä¸€ç§çŠ¶æ€ï¼Œä»»ä½•å…¶ä»–æ“ä½œéƒ½æ— æ³•æ”¹å˜è¿™ä¸ªçŠ¶æ€ã€‚</li>
<li>ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥å¾—åˆ°è¿™ä¸ªç»“æœã€‚<code>Promise</code>å¯¹è±¡çš„çŠ¶æ€æ”¹å˜ï¼Œåªæœ‰ä¸¤ç§å¯èƒ½ï¼šä»<code>pending</code>å˜ä¸º<code>fulfilled</code>å’Œä»<code>pending</code>å˜ä¸º<code>rejected</code>ã€‚åªè¦è¿™ä¸¤ç§æƒ…å†µå‘ç”Ÿï¼ŒçŠ¶æ€å°±ä¸ä¼šå†å˜ï¼Œä¼šä¸€ç›´ä¿æŒè¿™ä¸ªç»“æœï¼Œè¿™æ—¶å°±ç§°ä¸º resolvedï¼ˆå·²å®šå‹ï¼‰ã€‚å¦‚æœæ”¹å˜å·²ç»å‘ç”Ÿäº†ï¼Œä½ å†å¯¹<code>Promise</code>å¯¹è±¡æ·»åŠ å›è°ƒå‡½æ•°ï¼Œä¹Ÿä¼šç«‹å³å¾—åˆ°è¿™ä¸ªç»“æœã€‚è¿™ä¸äº‹ä»¶ï¼ˆEventï¼‰å®Œå…¨ä¸åŒï¼Œäº‹ä»¶çš„ç‰¹ç‚¹æ˜¯ï¼Œå¦‚æœä½ é”™è¿‡äº†å®ƒï¼Œå†å»ç›‘å¬ï¼Œæ˜¯å¾—ä¸åˆ°ç»“æœçš„ã€‚</li>
</ul>
<h4 id="3ï¼‰ç¼ºç‚¹"><a href="#3ï¼‰ç¼ºç‚¹" class="headerlink" title="3ï¼‰ç¼ºç‚¹"></a>3ï¼‰ç¼ºç‚¹</h4><ul>
<li>æ— æ³•å–æ¶ˆ<code>Promise</code>ï¼Œä¸€æ—¦æ–°å»ºå®ƒå°±ä¼šç«‹å³æ‰§è¡Œï¼Œæ— æ³•ä¸­é€”å–æ¶ˆã€‚</li>
<li>å¦‚æœä¸è®¾ç½®å›è°ƒå‡½æ•°ï¼Œ<code>Promise</code>å†…éƒ¨æŠ›å‡ºçš„é”™è¯¯ï¼Œä¸ä¼šååº”åˆ°å¤–éƒ¨ã€‚</li>
<li>å½“å¤„äº<code>pending</code>çŠ¶æ€æ—¶ï¼Œæ— æ³•å¾—çŸ¥ç›®å‰è¿›å±•åˆ°å“ªä¸€ä¸ªé˜¶æ®µï¼ˆåˆšåˆšå¼€å§‹è¿˜æ˜¯å³å°†å®Œæˆï¼‰ã€‚</li>
</ul>
<h3 id="2-Promise-å®ä¾‹"><a href="#2-Promise-å®ä¾‹" class="headerlink" title="2.Promise å®ä¾‹"></a>2.Promise å®ä¾‹</h3><p>Promise å¯¹è±¡æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆ Promise å®ä¾‹ï¼Œ Promise æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ resolve å’Œ reject ã€‚å®ƒä»¬æ˜¯ä¸¤ä¸ªå‡½æ•°ï¼Œç”± JavaScript å¼•æ“æä¾›ï¼Œä¸ç”¨è‡ªå·±éƒ¨ç½²ã€‚</p>
<p>resolve å‡½æ•°çš„ä½œç”¨ï¼šå°† Promise å¯¹è±¡çš„çŠ¶æ€ä» pendingï¼ˆæœªå®Œæˆï¼‰å˜ä¸º resolvedï¼ˆæˆåŠŸï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œæˆåŠŸæ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œçš„ç»“æœä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ã€‚</p>
<p>reject å‡½æ•°çš„ä½œç”¨ï¼šå°† Promise å¯¹è±¡çš„çŠ¶æ€ä» pendingï¼ˆæœªå®Œæˆï¼‰å˜ä¸º rejectedï¼ˆå¤±è´¥ï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œå¤±è´¥æ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œæŠ¥å‡ºçš„é”™è¯¯ä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ... some code</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="comment">/* å¼‚æ­¥æ“ä½œæˆåŠŸ */</span>)&#123;</span><br><span class="line">    resolve(value);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="3-æ–¹æ³•"><a href="#3-æ–¹æ³•" class="headerlink" title="3.æ–¹æ³•"></a>3.æ–¹æ³•</h3><h4 id="1ï¼‰then"><a href="#1ï¼‰then" class="headerlink" title="1ï¼‰then"></a>1ï¼‰then</h4><p>å®ƒçš„ä½œç”¨æ˜¯ Promise å®ä¾‹ç”Ÿæˆä»¥åï¼Œä¸º Promise å®ä¾‹æ·»åŠ çŠ¶æ€æ”¹å˜ï¼ˆresolvedã€rejectedï¼‰æ—¶çš„å›è°ƒå‡½æ•°ã€‚then æ–¹æ³•å¯ä»¥æ¥å—ä¸¤ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°æ˜¯ Promise å¯¹è±¡çš„çŠ¶æ€å˜ä¸º resolved æ—¶è°ƒç”¨ï¼Œç¬¬äºŒä¸ªå›è°ƒå‡½æ•°æ˜¯ Promise å¯¹è±¡çš„çŠ¶æ€å˜ä¸º rejected æ—¶è°ƒç”¨ã€‚å…¶ä¸­ï¼Œç¬¬äºŒä¸ªå‡½æ•°æ˜¯å¯é€‰çš„ï¼Œä¸ä¸€å®šè¦æä¾›ã€‚è¿™ä¸¤ä¸ªå‡½æ•°éƒ½æ¥å— Promise å¯¹è±¡ä¼ å‡ºçš„å€¼ä½œä¸ºå‚æ•°ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">promise.then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// success</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// failure</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Promise æ–°å»ºåå°±ä¼šç«‹å³æ‰§è¡Œã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Promise'</span>);</span><br><span class="line">  resolve();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'resolved.'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Hi!'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Promise</span></span><br><span class="line"><span class="comment">// Hi!</span></span><br><span class="line"><span class="comment">// resolved</span></span><br><span class="line"><span class="comment">// ä¸Šé¢ä»£ç ä¸­ï¼ŒPromise æ–°å»ºåç«‹å³æ‰§è¡Œï¼Œæ‰€ä»¥é¦–å…ˆè¾“å‡ºçš„æ˜¯Promiseã€‚ç„¶åï¼Œthenæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œå°†åœ¨å½“å‰è„šæœ¬æ‰€æœ‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ‰ä¼šæ‰§è¡Œï¼Œæ‰€ä»¥resolvedæœ€åè¾“å‡ºã€‚</span></span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨<code>resolve</code>æˆ–<code>reject</code>å¹¶ä¸ä¼šç»ˆç»“ Promise çš„å‚æ•°å‡½æ•°çš„æ‰§è¡Œã€‚å› ä¸ºç«‹å³ resolved çš„ Promise æ˜¯åœ¨æœ¬è½®äº‹ä»¶å¾ªç¯çš„æœ«å°¾æ‰§è¡Œï¼Œæ€»æ˜¯æ™šäºæœ¬è½®å¾ªç¯çš„åŒæ­¥ä»»åŠ¡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">1</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="params">r</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(r);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p><code>then</code>æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„<code>Promise</code>å®ä¾‹ï¼ˆæ³¨æ„ï¼Œä¸æ˜¯åŸæ¥é‚£ä¸ª<code>Promise</code>å®ä¾‹ï¼‰ã€‚å› æ­¤å¯ä»¥é‡‡ç”¨é“¾å¼å†™æ³•ï¼Œå³<code>then</code>æ–¹æ³•åé¢å†è°ƒç”¨å¦ä¸€ä¸ª<code>then</code>æ–¹æ³•ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">getJSON(<span class="string">"/posts.json"</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> json.post;</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">post</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="2ï¼‰catch"><a href="#2ï¼‰catch" class="headerlink" title="2ï¼‰catch"></a>2ï¼‰catch</h4><p><code>Promise.prototype.catch</code>æ–¹æ³•æ˜¯<code>.then(null, rejection)</code>æˆ–<code>.then(undefined, rejection)</code>çš„åˆ«åï¼Œç”¨äºæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶çš„å›è°ƒå‡½æ•°ã€‚Promise å¯¹è±¡çš„é”™è¯¯å…·æœ‰â€œå†’æ³¡â€æ€§è´¨ï¼Œä¼šä¸€ç›´å‘åä¼ é€’ï¼Œç›´åˆ°è¢«æ•è·ä¸ºæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé”™è¯¯æ€»æ˜¯ä¼šè¢«ä¸‹ä¸€ä¸ª<code>catch</code>è¯­å¥æ•è·ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">doSomething()</span><br><span class="line">.then(<span class="function"><span class="params">result</span> =&gt;</span> doSomethingElse(result))</span><br><span class="line">.then(<span class="function"><span class="params">newResult</span> =&gt;</span> doThirdThing(newResult))</span><br><span class="line">.then(<span class="function"><span class="params">finalResult</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Got the final result: <span class="subst">$&#123;finalResult&#125;</span>`</span>);</span><br><span class="line">&#125;)</span><br><span class="line">.catch(failureCallback);</span><br></pre></td></tr></table></figure>
<h4 id="3ï¼‰finally"><a href="#3ï¼‰finally" class="headerlink" title="3ï¼‰finally"></a>3ï¼‰finally</h4><p><code>finally</code>æ–¹æ³•ç”¨äºæŒ‡å®šä¸ç®¡ Promise å¯¹è±¡æœ€åçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œã€‚<code>finally</code>æ–¹æ³•çš„å›è°ƒå‡½æ•°ä¸æ¥å—ä»»ä½•å‚æ•°ï¼Œæ‰€ä»¥<code>finally</code>æ–¹æ³•é‡Œé¢çš„æ“ä½œï¼Œä¸çŠ¶æ€æ— å…³ï¼Œä¸ä¾èµ–äº Promise çš„æ‰§è¡Œç»“æœã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">promise</span><br><span class="line">.then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;Â·Â·Â·&#125;)</span><br><span class="line">.catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;Â·Â·Â·&#125;)</span><br><span class="line">.finally(<span class="function"><span class="params">()</span> =&gt;</span> &#123;Â·Â·Â·&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="4ï¼‰all"><a href="#4ï¼‰all" class="headerlink" title="4ï¼‰all"></a>4ï¼‰all</h4><p><code>Promise.all</code>æ–¹æ³•ç”¨äºå°†å¤šä¸ª Promise å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚å½“æ‰€æœ‰çš„Promiseçš„ç»“æœéƒ½æ˜¯resolveï¼Œæ‰ä¼šå»æ‰§è¡Œthenæ–¹æ³•é‡Œçš„å†…å®¹ã€‚å¦‚æœæœ‰ä¸€ä¸ªæ˜¯rejectï¼Œå°±ä¼šæ‰§è¡Œcatché‡Œçš„å†…å®¹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span></span><br><span class="line">.all([Promise1, Promise2])</span><br><span class="line">.then(res = &gt; &#123;â€¦&#125;)</span><br><span class="line">.catch(err = &gt; &#123;â€¦&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="5ï¼‰race"><a href="#5ï¼‰race" class="headerlink" title="5ï¼‰race"></a>5ï¼‰race</h4><p><code>Promise.race</code>æ–¹æ³•åŒæ ·æ˜¯å°†å¤šä¸ª Promise å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚çŠ¶æ€ç”±ç¬¬ä¸€ä¸ªè¿”å›çš„Promiseå¾—çŠ¶æ€å†³å®šï¼Œç¬¬ä¸€ä¸ªæ˜¯resolveå°±æ‰§è¡Œthenï¼Œè¿”å›çš„æ˜¯rejectå°±æ‰§è¡Œcatchã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span></span><br><span class="line">.race([Promise1, Promise2])</span><br><span class="line">.then(res = &gt; &#123;â€¦&#125;)</span><br><span class="line">.catch(err = &gt; &#123;â€¦&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="6ï¼‰resolve"><a href="#6ï¼‰resolve" class="headerlink" title="6ï¼‰resolve"></a>6ï¼‰resolve</h4><p>å°†ç°æœ‰å¯¹è±¡è½¬ä¸º Promise å¯¹è±¡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve(<span class="string">'foo'</span>)</span><br><span class="line"><span class="comment">// ç­‰ä»·äº</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> resolve(<span class="string">'foo'</span>))</span><br></pre></td></tr></table></figure>
<h4 id="7ï¼‰reject"><a href="#7ï¼‰reject" class="headerlink" title="7ï¼‰reject"></a>7ï¼‰reject</h4><p><code>Promise.reject(reason)</code>æ–¹æ³•ä¹Ÿä¼šè¿”å›ä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ï¼Œè¯¥å®ä¾‹çš„çŠ¶æ€ä¸º<code>rejected</code>ã€‚</p>
<h3 id="4-ES5å®ç°promise"><a href="#4-ES5å®ç°promise" class="headerlink" title="4.ES5å®ç°promise"></a>4.ES5å®ç°promise</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span></span><br><span class="line">  self.status = <span class="string">'pending'</span> <span class="comment">// Promiseå½“å‰çš„çŠ¶æ€</span></span><br><span class="line">  self.data = <span class="literal">undefined</span>  <span class="comment">// Promiseçš„å€¼</span></span><br><span class="line">  self.onResolvedCallback = [] <span class="comment">// Promise resolveæ—¶çš„å›è°ƒå‡½æ•°é›†</span></span><br><span class="line">  self.onRejectedCallback = [] <span class="comment">// Promise rejectæ—¶çš„å›è°ƒå‡½æ•°é›†</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(self.status==<span class="string">'pending'</span>)&#123;</span><br><span class="line">          self.status==<span class="string">'fulfilled'</span>;</span><br><span class="line">          self.data=value;</span><br><span class="line">          <span class="comment">// ä¾æ¬¡æ‰§è¡ŒæˆåŠŸä¹‹åçš„å‡½æ•°æ ˆ</span></span><br><span class="line">          <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; self.onResolvedCallback.length; i++) &#123;</span><br><span class="line">            self.onResolvedCallback[i](value)</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">rejecte</span>(<span class="params">error</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (self.status === <span class="string">'pending'</span>) &#123;</span><br><span class="line">       self.status = <span class="string">'rejected'</span>;</span><br><span class="line">       self.data = error;</span><br><span class="line">       <span class="comment">// ä¾æ¬¡æ‰§è¡Œå¤±è´¥ä¹‹åçš„å‡½æ•°æ ˆ</span></span><br><span class="line">       <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; self.onRejectedCallback.length; i++) &#123;</span><br><span class="line">           self.onRejectedCallback[i](error)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123; <span class="comment">// è€ƒè™‘åˆ°æ‰§è¡Œexecutorçš„è¿‡ç¨‹ä¸­æœ‰å¯èƒ½å‡ºé”™ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨try/catchå—ç»™åŒ…èµ·æ¥ï¼Œå¹¶ä¸”åœ¨å‡ºé”™åä»¥catchåˆ°çš„å€¼rejectæ‰è¿™ä¸ªPromise</span></span><br><span class="line">    executor(resolve, reject) <span class="comment">// æ‰§è¡Œexecutor</span></span><br><span class="line">  &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">    reject(e)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.prototype.then = <span class="function"><span class="keyword">function</span>(<span class="params">onResolved, onRejected</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">var</span> promise2;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ ¹æ®æ ‡å‡†ï¼Œå¦‚æœthençš„å‚æ•°ä¸æ˜¯functionï¼Œåˆ™æˆ‘ä»¬éœ€è¦å¿½ç•¥å®ƒï¼Œæ­¤å¤„ä»¥å¦‚ä¸‹æ–¹å¼å¤„ç†</span></span><br><span class="line">  onResolved = <span class="keyword">typeof</span> onResolved === <span class="string">'function'</span> ? onResolved : <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;&#125;</span><br><span class="line">  onRejected = <span class="keyword">typeof</span> onRejected === <span class="string">'function'</span> ? onRejected : <span class="function"><span class="keyword">function</span>(<span class="params">reason</span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (self.status === <span class="string">'resolved'</span>) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœpromise1(æ­¤å¤„å³ä¸ºthis/self)çš„çŠ¶æ€å·²ç»ç¡®å®šå¹¶ä¸”æ˜¯resolvedï¼Œæˆ‘ä»¬è°ƒç”¨onResolved</span></span><br><span class="line">    <span class="comment">// å› ä¸ºè€ƒè™‘åˆ°æœ‰å¯èƒ½throwï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å…¶åŒ…åœ¨try/catchå—é‡Œ</span></span><br><span class="line">    <span class="keyword">return</span> promise2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> x = onResolved(self.data)</span><br><span class="line">        <span class="keyword">if</span> (x <span class="keyword">instanceof</span> <span class="built_in">Promise</span>) &#123; <span class="comment">// å¦‚æœonResolvedçš„è¿”å›å€¼æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œç›´æ¥å–å®ƒçš„ç»“æœåšä¸ºpromise2çš„ç»“æœ</span></span><br><span class="line">          x.then(resolve, reject)</span><br><span class="line">        &#125;</span><br><span class="line">        resolve(x) <span class="comment">// å¦åˆ™ï¼Œä»¥å®ƒçš„è¿”å›å€¼åšä¸ºpromise2çš„ç»“æœ</span></span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        reject(e) <span class="comment">// å¦‚æœå‡ºé”™ï¼Œä»¥æ•è·åˆ°çš„é”™è¯¯åšä¸ºpromise2çš„ç»“æœ</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ­¤å¤„ä¸å‰ä¸€ä¸ªifå—çš„é€»è¾‘å‡ ä¹ç›¸åŒï¼ŒåŒºåˆ«åœ¨äºæ‰€è°ƒç”¨çš„æ˜¯onRejectedå‡½æ•°ï¼Œå°±ä¸å†åšè¿‡å¤šè§£é‡Š</span></span><br><span class="line">  <span class="keyword">if</span> (self.status === <span class="string">'rejected'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> promise2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> x = onRejected(self.data)</span><br><span class="line">        <span class="keyword">if</span> (x <span class="keyword">instanceof</span> <span class="built_in">Promise</span>) &#123;</span><br><span class="line">          x.then(resolve, reject)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        reject(e)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (self.status === <span class="string">'pending'</span>) &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœå½“å‰çš„Promiseè¿˜å¤„äºpendingçŠ¶æ€ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½ç¡®å®šè°ƒç”¨onResolvedè¿˜æ˜¯onRejectedï¼Œ</span></span><br><span class="line">  <span class="comment">// åªèƒ½ç­‰åˆ°Promiseçš„çŠ¶æ€ç¡®å®šåï¼Œæ‰èƒ½ç¡®å®å¦‚ä½•å¤„ç†ã€‚</span></span><br><span class="line">  <span class="comment">// æ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠæˆ‘ä»¬çš„**ä¸¤ç§æƒ…å†µ**çš„å¤„ç†é€»è¾‘åšä¸ºcallbackæ”¾å…¥promise1(æ­¤å¤„å³this/self)çš„å›è°ƒæ•°ç»„é‡Œ</span></span><br><span class="line">  <span class="comment">// é€»è¾‘æœ¬èº«è·Ÿç¬¬ä¸€ä¸ªifå—å†…çš„å‡ ä¹ä¸€è‡´ï¼Œæ­¤å¤„ä¸åšè¿‡å¤šè§£é‡Š</span></span><br><span class="line">    <span class="keyword">return</span> promise2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">      self.onResolvedCallback.push(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">var</span> x = onResolved(self.data)</span><br><span class="line">          <span class="keyword">if</span> (x <span class="keyword">instanceof</span> <span class="built_in">Promise</span>) &#123;</span><br><span class="line">            x.then(resolve, reject)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          reject(e)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      self.onRejectedCallback.push(<span class="function"><span class="keyword">function</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">var</span> x = onRejected(self.data)</span><br><span class="line">          <span class="keyword">if</span> (x <span class="keyword">instanceof</span> <span class="built_in">Promise</span>) &#123;</span><br><span class="line">            x.then(resolve, reject)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          reject(e)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ºäº†ä¸‹æ–‡æ–¹ä¾¿ï¼Œæˆ‘ä»¬é¡ºä¾¿å®ç°ä¸€ä¸ªcatchæ–¹æ³•</span></span><br><span class="line"><span class="built_in">Promise</span>.prototype.catch = <span class="function"><span class="keyword">function</span>(<span class="params">onRejected</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.then(<span class="literal">null</span>, onRejected)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒé“¾æ¥ï¼š <a href="https://juejin.im/post/5b2f02cd5188252b937548ab" target="_blank" rel="noopener">https://juejin.im/post/5b2f02cd5188252b937548ab</a></p>
<h2 id="ä¸‰-Axios"><a href="#ä¸‰-Axios" class="headerlink" title="ä¸‰ Axios"></a>ä¸‰ Axios</h2><p>Axios æ˜¯ä¸€ä¸ªåŸºäº promise çš„ HTTP åº“ï¼Œæ”¯æŒPromise APIï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬å‘èµ·AJAXè¯·æ±‚ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">axios.get(â€˜ https:<span class="comment">//baiduâ€¦â€¦â€™)</span></span><br><span class="line">.then(res = &gt; &#123;â€¦&#125;)</span><br><span class="line">.catch(err = &gt; &#123;â€¦&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="å››-è·¨åŸŸ"><a href="#å››-è·¨åŸŸ" class="headerlink" title="å›› è·¨åŸŸ"></a>å›› è·¨åŸŸ</h2><h3 id="åŒæºç­–ç•¥ï¼šæµè§ˆå™¨çš„ä¸€ç§å®‰å…¨æœºåˆ¶"><a href="#åŒæºç­–ç•¥ï¼šæµè§ˆå™¨çš„ä¸€ç§å®‰å…¨æœºåˆ¶" class="headerlink" title="åŒæºç­–ç•¥ï¼šæµè§ˆå™¨çš„ä¸€ç§å®‰å…¨æœºåˆ¶"></a>åŒæºç­–ç•¥ï¼šæµè§ˆå™¨çš„ä¸€ç§å®‰å…¨æœºåˆ¶</h3><p>URLç”±åè®®ã€åŸŸåã€ç«¯å£å’Œè·¯å¾„ç»„æˆï¼Œå¦‚æœä¸¤ä¸ªURLçš„åè®®ã€åŸŸåå’Œç«¯å£ç›¸åŒï¼Œåˆ™è¡¨ç¤ºä»–ä»¬åŒæºã€‚å½“æµè§ˆå™¨ä»ä¸€ä¸ªåŸŸåçš„ç½‘é¡µå»è¯·æ±‚å¦ä¸€ä¸ªåŸŸåçš„èµ„æºæ—¶ï¼Œåè®®ã€åŸŸåã€ç«¯å£ä»»ä¸€ä¸€ä¸ªä¸åŒéƒ½æ˜¯è·¨åŸŸã€‚AJAX å—åŒæºç­–ç•¥å½±å“ï¼Œä¸èƒ½å‘é€è·¨åŸŸè¯·æ±‚ã€‚ä¸‹é¢æ˜¯è§£å†³è·¨åŸŸçš„å‡ ç§æ–¹å¼ã€‚</p>
<h3 id="1-è¿œç¨‹ä»£ç†"><a href="#1-è¿œç¨‹ä»£ç†" class="headerlink" title="1.è¿œç¨‹ä»£ç†"></a>1.è¿œç¨‹ä»£ç†</h3><p>åŒæºç­–ç•¥æ˜¯æµè§ˆå™¨çš„å®‰å…¨ç­–ç•¥ï¼Œä¸æ˜¯HTTPåè®®çš„è¦æ±‚ã€‚æ‰€ä»¥åªè¦å°†è¯·æ±‚çš„å‘é€æ–¹äº¤ç”±æœåŠ¡ç«¯å‘é€å°±å¯ä»¥ç»•è¿‡åŒæºç­–ç•¥äº†ã€‚è¿œç¨‹ä»£ç†å°±æ˜¯åˆ©ç”¨åˆ«äººå†™å¥½çš„ä»£ç†æ¥å£ä»£ç†å‘é€ä½ çš„è¯·æ±‚ï¼Œå°±ä¸å­˜åœ¨è·¨åŸŸé—®é¢˜äº†ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå¸¸é‡  API_PROXY æ¥ä¿å­˜ä»£ç†çš„æ¥å£</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> API_PROXY = <span class="string">'https://bird.ioliu.cn/v1/?url='</span></span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨axiosè¯·æ±‚é‡Œé¢å’Œä½ çš„urlæ‹¼æ¥ä¸€ä¸‹å°±OKäº†</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">axios.get(_this.$store.state.API_PROXY + <span class="string">'http://news-at.zhihu.com/api/4/stories/latest'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="2-JSONP"><a href="#2-JSONP" class="headerlink" title="2.JSONP"></a>2.JSONP</h3><p>JSONP å®ç°è·¨åŸŸæ˜¯åˆ©ç”¨ script æ ‡ç­¾ä¸å—åŒæºç­–ç•¥çš„å½±å“ï¼Œå°†è¦è¯·æ±‚çš„åœ°å€æ·»åŠ åˆ° script æ ‡ç­¾çš„ src å±æ€§ä¸­ï¼Œå†å°†è¯¥ script æ ‡ç­¾æ·»åŠ åˆ°é¡µé¢ã€‚åœ¨èµ„æºåŠ è½½åç«‹å³æ‰§è¡Œã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// å®¢æˆ·ç«¯</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line">   <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">   script.type = <span class="string">'text/javascript'</span>;</span><br><span class="line">   <span class="comment">// ä¼ å‚å¹¶æŒ‡å®šå›è°ƒæ‰§è¡Œå‡½æ•°ä¸ºonBack</span></span><br><span class="line">   script.src = <span class="string">'http://www.domain2.com:8080/login?user=admin&amp;callback=onBack'</span>;</span><br><span class="line">   <span class="built_in">document</span>.head.appendChild(script);</span><br><span class="line"></span><br><span class="line">   <span class="comment">// å›è°ƒæ‰§è¡Œå‡½æ•°</span></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">onBack</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">       alert(<span class="built_in">JSON</span>.stringify(res));</span><br><span class="line">   &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">   /</span><span class="regexp">/ æœåŠ¡å™¨</span></span><br><span class="line"><span class="regexp">onBack(&#123;"status": true, "user": "admin"&#125;)</span></span><br></pre></td></tr></table></figure>
<p><strong>ç¼ºç‚¹</strong>ï¼šåªæ”¯æŒ get æ–¹æ³•</p>
<p>jsonp çœ‹ä¼¼å’Œ json å¾ˆåƒï¼Œå®ƒæ˜¯åŒ…å«åœ¨å‡½æ•°è°ƒç”¨ä¸­çš„ jsonã€‚</p>
<h3 id="3-CORSï¼ˆCross-Origin-Resource-Sharing-è·¨æºèµ„æºå…±äº«ï¼‰"><a href="#3-CORSï¼ˆCross-Origin-Resource-Sharing-è·¨æºèµ„æºå…±äº«ï¼‰" class="headerlink" title="3.CORSï¼ˆCross-Origin Resource Sharing è·¨æºèµ„æºå…±äº«ï¼‰"></a>3.CORSï¼ˆCross-Origin Resource Sharing è·¨æºèµ„æºå…±äº«ï¼‰</h3><p>CORSçš„åŸç†ï¼Œå°±æ˜¯ä½¿ç”¨è‡ªå®šä¹‰çš„HTTPå¤´éƒ¨è®©æµè§ˆå™¨å’ŒæœåŠ¡å™¨é€šä¿¡ï¼Œä»è€Œå†³å®šè¯·æ±‚æˆ–å“åº”åº”è¯¥æˆåŠŸè¿˜æ˜¯å¤±è´¥ã€‚é¦–å…ˆ CORS éœ€è¦æµè§ˆå™¨å’ŒæœåŠ¡å™¨åŒæ—¶æ”¯æŒã€‚ç›®å‰ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒè¯¥åŠŸèƒ½ï¼ŒIEæµè§ˆå™¨ä¸èƒ½ä½äºIE10ã€‚æ•´ä¸ªCORSé€šä¿¡è¿‡ç¨‹ï¼Œæµè§ˆå™¨åœ¨å‘è¯·æ±‚æ—¶ä¼šæ·»åŠ ä¸€ä¸ª Origin å­—æ®µï¼ˆæµè§ˆå™¨ç«¯è‡ªåŠ¨å®Œæˆï¼Œä¸éœ€è¦ç”¨æˆ·å‚ä¸ï¼‰ï¼Œç”¨äºå‘Šè¯‰æœåŠ¡å™¨è¯·æ±‚é¡µé¢çš„æºä¿¡æ¯ã€‚æœåŠ¡å™¨æ ¹æ® Origin çš„å€¼å†³å®šæ˜¯å¦å…è®¸è¯¥è·¨åŸŸè¯·æ±‚ï¼Œé»˜è®¤æƒ…å†µæ˜¯ä¸å…è®¸çš„ã€‚</p>
<p>å…·ä½“æ“ä½œæ˜¯åœ¨åç«¯è®¾ç½®ä¸€ä¸ª Access-Control-Allow-Origin çš„å“åº”å¤´ï¼Œå€¼ä¸ºå…è®¸å‘é€è·¨åŸŸè¯·æ±‚çš„åœ°å€ã€‚æµè§ˆå™¨åˆ¤æ–­è¯¥å“åº”å¤´ä¸­æ˜¯å¦åŒ…å« Origin çš„å€¼ï¼Œå¦‚æœåŒ…å«æµè§ˆå™¨åˆ™å¤„ç†å“åº”ï¼Œå¦åˆ™ç›´æ¥é©³å›ï¼Œæ— æ³•å¾—åˆ°å“åº”æ•°æ®ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœåŠ¡å™¨</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addMapping(<span class="string">"/**"</span>)</span><br><span class="line">                .allowedOrigins(<span class="string">"*"</span>)</span><br><span class="line">                .allowedMethods(<span class="string">"*"</span>)</span><br><span class="line">                .allowCredentials(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä»–å­—æ®µ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆ<span class="number">1</span>ï¼‰Access-Control-Allow-Origin</span><br><span class="line"><span class="comment">//ç”¨æ¥å‘Šè¯‰æµè§ˆå™¨æœåŠ¡ç«¯æ¥æ”¶å“ªäº›åŸŸçš„è¯·æ±‚ï¼Œå€¼å¯ä»¥æ˜¯ä¸€ä¸ªå…·ä½“çš„åŸŸåï¼ˆwww.baidu.comï¼‰,ä¹Ÿå¯ä»¥æ˜¯é€šé…ç¬¦ï¼ˆ*ï¼‰</span></span><br><span class="line">ï¼ˆ<span class="number">2</span>ï¼‰Access-Control-Allow-Credentials</span><br><span class="line"><span class="comment">//ç”¨æ¥æ ‡è¯†æœåŠ¡ç«¯æ˜¯å¦å…è®¸å‘é€Cookieï¼Œéœ€è¦æ­é…XMLHttpRequestçš„withCredentialsä¸€èµ·ä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="comment">//å¦‚æœè®¾ç½®ä¸ºå‘é€Cookieæ—¶ï¼ŒAccess-Control-Allow-Originå¿…é¡»åˆ¶å®šå…·ä½“åŸŸåï¼Œè€Œä¸èƒ½æ˜¯é€šé…ç¬¦ï¼ˆ*ï¼‰</span></span><br><span class="line">ï¼ˆ<span class="number">3</span>ï¼‰Access-Control-Expose-Headers</span><br><span class="line"><span class="comment">//ç”¨æ¥æ ‡è¯†å…è®¸è·å–çš„è¿”å›å¤´å†…å®¹</span></span><br><span class="line">ï¼ˆ<span class="number">4</span>ï¼‰Access-Control-Allow-Methods</span><br><span class="line"><span class="comment">//è¯¥å€¼å¿…éœ€ï¼Œç”¨æ¥å‘Šè¯‰æµè§ˆå™¨æœåŠ¡ç«¯æ”¯æŒçš„æ‰€æœ‰è¯·æ±‚ç±»å‹</span></span><br><span class="line">ï¼ˆ<span class="number">5</span>ï¼‰Access-Control-Allow-Headers</span><br><span class="line"><span class="comment">//å¦‚æœæ˜¯å¤æ‚è¯·æ±‚ï¼Œè¯¥å€¼å¿…éœ€ã€‚ç”¨æ¥è¡¨æ˜æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰å¤´ä¿¡æ¯</span></span><br><span class="line">ï¼ˆ<span class="number">6</span>ï¼‰Access-Control-Max-Age</span><br><span class="line"><span class="comment">//æ ‡è¯†å¤æ‚è¯·æ±‚ä¸‹é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸã€‚</span></span><br></pre></td></tr></table></figure><div class="qr-code"></div><img class="qrcode-img" src="/img/weixin.jpg"><div class="qrcode-desc">å¾®ä¿¡æ‰“èµ</div><div class="post-tag-list">æ ‡ç­¾: <a class="post-tags" href="/tags/JavaScript/">JavaScript</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2018/07/16/è®¡ç®—æœºç½‘ç»œæ€»/"><i class="fa fa-chevron-left"></i><span>è®¡ç®—æœºç½‘ç»œ</span></a></div><div class="next-post pull-right"><a href="/2018/06/01/vueç”Ÿå‘½å‘¨æœŸ/"><span>vueç”Ÿå‘½å‘¨æœŸ</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: 'e238e2d1f25ec6e15026',
  clientSecret: '3c4e537d46a59d056e6c0cc478b04784defafcfb',
  repo: 'Yin-Hongwei.github.io',
  owner: 'Yin-Hongwei',
  admin: 'Yin-Hongwei',
  id: md5(window.location.pathname)
})
gitalk.render('gitalk-container')</script></article></section></article><footer id="footer-outer"><div id="footer-inner"><p class="footer-text">Copyright &copy; 2018-2020</p><p class="footer-text">Designed by Yin-Hongwei</p></div></footer></body><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="/js/main.js" defer></script></html>